---
title: "Common dplyr idioms for the life sciences"
author: "Sean Hughes / Claire Levy"
date: "Monday, January 26, 2015"
output: html_document
---

## Introduction

Life scientists often need to perform several common tasks with data generated by instruments: 

* average replicate rows
* normalize experimental rows to control rows
* find and exclude outliers

The R package [dplyr](http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html) package makes data manipulation easy. The idioms described below use `dplyr` to perform these common tasks. 

We'll use a data set from a simple experiment to illustrate these idioms. `expt` contains data from an experiment where samples from four different sources (A, B, C, and D) were exposed to DrugX or DrugY at concentrations of 1, 10, 100, or 1000, or exposed to no drug. Every condition was performed in duplicate. 

```{r message=FALSE, warning=FALSE, results='hide'}
library(dplyr)
expt <- read.csv("expt.csv")
head(expt)
#>   Sample Treatment Concentration Replicate       Data
#> 1      A     DrugX             1         1 19.5000000
#> 2      A     DrugX             1         2  8.0000000
#> 3      A     DrugX            10         1  3.0909091
#> 4      A     DrugX            10         2  8.9090909
#> 5      A     DrugX           100         1  0.2277228
#> 6      A     DrugX           100         2  0.9504950
str(expt)
#> 'data.frame':   72 obs. of  5 variables:
#>  $ Sample       : Factor w/ 4 levels "A","B","C","D": 1 1 1 1 1 1 1 1 1 1 ...
#>  $ Treatment    : Factor w/ 3 levels "DrugX","DrugY",..: 1 1 1 1 1 1 1 1 2 2 ...
#>  $ Concentration: int  1 1 10 10 100 100 1000 1000 1 1 ...
#>  $ Replicate    : int  1 2 1 2 1 2 1 2 1 2 ...
#>  $ Data         : num  19.5 8 3.091 8.909 0.228 ...
```

The `Data` column contains the experimentally-measured data, which decreases with increasing concentration of drug.

```{r message=FALSE, warning=FALSE}
library(ggplot2)
ggplot(expt, aes(factor(Concentration ), log10(Data))) + 
   geom_point(
      aes(color = Treatment),
      size = 3) + 
   facet_wrap( ~ Sample) + 
   ylab("Response to drug treatment (log10 transformed)") + 
   xlab("Concentration of drug") +
   ggtitle("Samplewise response to drug treatment")

```

## Average replicates
(Claire)
include inter-replicate CV column in addition to avged values

## Normalize to control data
%ctrl 

## Exclude outliers
Inter-replicate CV, too high, too low